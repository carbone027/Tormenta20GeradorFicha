<%- include('partials/header', { title: 'Erro - Tormenta20' }) %>

  <section class="content-section active error-section">
    <div class="error-container">
      <div class="error-illustration">
        <% let errorIcon='ğŸ˜”' ; let errorTitle='Algo deu errado' ; let errorDescription='Ocorreu um erro inesperado.' ;
          if (error && error.status) { switch(error.status) { case 404: errorIcon='ğŸ—ºï¸' ;
          errorTitle='PÃ¡gina Perdida nas Terras de Arton' ;
          errorDescription='A pÃ¡gina que vocÃª procura desapareceu como um tesouro em uma masmorra abandonada.' ; break;
          case 403: errorIcon='ğŸ›¡ï¸' ; errorTitle='Acesso Negado pelo Guarda' ;
          errorDescription='VocÃª nÃ£o possui as credenciais necessÃ¡rias para acessar esta Ã¡rea protegida.' ; break; case
          500: errorIcon='âš¡' ; errorTitle='Tempestade MÃ¡gica no Servidor' ;
          errorDescription='Os ventos arcanos perturbaram nossos sistemas. Nossos magos estÃ£o trabalhando para restaurar a ordem.'
          ; break; default: errorIcon='ğŸ²' ; errorTitle='Falha CrÃ­tica nos Dados' ;
          errorDescription='Parece que os dados nÃ£o foram favorÃ¡veis desta vez.' ; } } %>

          <div class="error-icon">
            <%= errorIcon %>
          </div>
          <h1 class="error-title">
            <%= errorTitle %>
          </h1>
          <p class="error-description">
            <%= errorDescription %>
          </p>

          <% if (error && error.status) { %>
            <div class="error-code">
              <span class="error-status">CÃ³digo do Erro: <%= error.status %></span>
            </div>
            <% } %>
      </div>

      <div class="error-message-card">
        <h3>ğŸ“œ Detalhes da Aventura Mal Sucedida</h3>
        <div class="error-details">
          <% if (message) { %>
            <div class="error-detail">
              <span class="detail-label">ğŸ¯ Problema:</span>
              <span class="detail-value">
                <%= message %>
              </span>
            </div>
            <% } %>

              <% if (error && error.status) { %>
                <div class="error-detail">
                  <span class="detail-label">ğŸ”¢ CÃ³digo:</span>
                  <span class="detail-value">
                    <%= error.status %>
                  </span>
                </div>
                <% } %>

                  <div class="error-detail">
                    <span class="detail-label">â° HorÃ¡rio:</span>
                    <span class="detail-value">
                      <%= new Date().toLocaleString('pt-BR') %>
                    </span>
                  </div>

                  <div class="error-detail">
                    <span class="detail-label">ğŸŒ PÃ¡gina:</span>
                    <span class="detail-value">
                      <%= typeof originalUrl !=='undefined' ? originalUrl : 'Desconhecida' %>
                    </span>
                  </div>
        </div>
      </div>

      <!-- AÃ§Ãµes Sugeridas -->
      <div class="error-actions">
        <h3>âš”ï¸ Como Continuar Sua Jornada</h3>
        <div class="actions-grid">
          <a href="/" class="action-btn primary-action">
            ğŸ  Retornar Ã  Taverna (InÃ­cio)
          </a>

          <button onclick="history.back()" class="action-btn secondary-action">
            â†©ï¸ Voltar ao Local Anterior
          </button>

          <button onclick="location.reload()" class="action-btn utility-action">
            ğŸ”„ Tentar Novamente
          </button>

          <% if (user) { %>
            <a href="/personagens" class="action-btn character-action">
              ğŸ“‹ Ver Meus Personagens
            </a>
            <% } else { %>
              <a href="/login" class="action-btn character-action">
                ğŸ” Fazer Login
              </a>
              <% } %>
        </div>
      </div>

      <!-- Dicas Ãšteis -->
      <div class="error-tips">
        <h3>ğŸ’¡ Dicas do Mestre</h3>
        <div class="tips-grid">
          <div class="tip-card">
            <div class="tip-icon">ğŸ—ºï¸</div>
            <h4>NavegaÃ§Ã£o</h4>
            <p>Use o menu principal para navegar pelas diferentes seÃ§Ãµes do sistema.</p>
          </div>

          <div class="tip-card">
            <div class="tip-icon">ğŸ”—</div>
            <h4>Links Quebrados</h4>
            <p>Se um link nÃ£o funcionar, tente acessar a pÃ¡gina atravÃ©s do menu principal.</p>
          </div>

          <div class="tip-card">
            <div class="tip-icon">ğŸ’¾</div>
            <h4>Dados Salvos</h4>
            <p>Seus personagens estÃ£o seguros! Erros tÃ©cnicos nÃ£o afetam seus dados salvos.</p>
          </div>

          <div class="tip-card">
            <div class="tip-icon">ğŸ”„</div>
            <h4>Problemas TemporÃ¡rios</h4>
            <p>Se persistir, aguarde alguns minutos e tente novamente. Pode ser um problema temporÃ¡rio.</p>
          </div>
        </div>
      </div>

      <!-- InformaÃ§Ãµes de Debug (apenas em desenvolvimento) -->
      <% if (process.env.NODE_ENV !=='production' && error && error.stack) { %>
        <div class="debug-info">
          <h3>ğŸ”§ InformaÃ§Ãµes de Debug</h3>
          <div class="debug-card">
            <pre class="debug-stack"><%= error.stack %></pre>
          </div>
        </div>
        <% } %>

          <!-- Easter Egg / Flavor Text -->
          <div class="flavor-text">
            <div class="flavor-card">
              <h4>ğŸ“– CrÃ´nicas de Arton</h4>
              <p class="flavor-quote">
                <% const
                  flavorTexts=[ '"Mesmo os maiores herÃ³is enfrentam obstÃ¡culos em suas jornadas. O importante Ã© nÃ£o desistir." - SÃ¡bio de Valkaria'
                  , '"Toda aventura tem seus percalÃ§os. Um verdadeiro aventureiro aprende com cada erro." - Mestre Explorador'
                  , '"Em Arton, atÃ© os contratempos fazem parte da grande histÃ³ria que vocÃª estÃ¡ escrevendo." - Cronista Real'
                  , '"NÃ£o hÃ¡ falha que nÃ£o possa ser superada com determinaÃ§Ã£o e um bom plano." - Estrategista Militar'
                  , '"Lembre-se: cada erro Ã© uma oportunidade de aprender algo novo sobre o mundo." - Arquimago da Torre'
                  ]; const randomFlavor=flavorTexts[Math.floor(Math.random() * flavorTexts.length)]; %>
                  <%= randomFlavor %>
              </p>
            </div>
          </div>
    </div>
  </section>

  <style>

  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Adicionar atributo data-status se houver cÃ³digo de erro
      if (error && error.status) {
        const container = document.querySelector('.error-container');
        if (container) {
          container.setAttribute('data-status', '<%= error.status %>');
        }
      }

      // Adicionar efeito de digitaÃ§Ã£o no tÃ­tulo
      const title = document.querySelector('.error-title');
      if (title) {
        const originalText = title.textContent;
        title.textContent = '';

        let i = 0;
        const typeWriter = () => {
          if (i < originalText.length) {
            title.textContent += originalText.charAt(i);
            i++;
            setTimeout(typeWriter, 50);
          }
        };

        setTimeout(typeWriter, 500);
      }

      // Adicionar efeito de shake no Ã­cone quando clicado
      const errorIcon = document.querySelector('.error-icon');
      if (errorIcon) {
        errorIcon.addEventListener('click', function () {
          this.style.animation = 'none';
          setTimeout(() => {
            this.style.animation = 'bounce 0.5s ease-out';
          }, 10);
        });
      }

      // Auto-refresh em caso de erro 500 (apÃ³s 30 segundos)
      if (error && error.status === 500) {
        let countdown = 30;
        const refreshBtn = document.querySelector('.utility-action');

        if (refreshBtn) {
          const originalText = refreshBtn.textContent;

          const updateCountdown = () => {
            refreshBtn.textContent = `ğŸ”„ Auto-refresh em ${countdown}s`;
            countdown--;

            if (countdown <= 0) {
              location.reload();
            } else {
              setTimeout(updateCountdown, 1000);
            }
          };

          // ComeÃ§ar countdown apÃ³s 5 segundos
          setTimeout(() => {
            updateCountdown();
          }, 5000);
        }
      }

      // Log do erro para anÃ¡lise (apenas em desenvolvimento)
      if (process.env.NODE_ENV !== 'production') {
        console.group('ğŸ› InformaÃ§Ãµes do Erro');
        console.log('Mensagem:', '<%= message || "N/A" %>');
        console.log('Status:', '<%= error && error.status ? error.status : "N/A" %>');
        console.log('URL:', '<%= typeof originalUrl !== "undefined" ? originalUrl : "N/A" %>');
        console.log('Timestamp:', new Date().toISOString());
        if (error && error.stack) {
          console.log('Stack Trace:', error.stack);
        };
      };
    });
  </script>

  <%- include('partials/footer') %>}