<%- include('../partials/header', { title: 'Criar Personagem' , activePage: 'createCharacter' }) %>

<%
// ===== ADICIONAR A FUN√á√ÉO AQUI, LOGO AP√ìS O INCLUDE DO HEADER =====
// Fun√ß√£o para gerar √≠cones de poderes
function getPowerIcon(poder, tipo) {
  const nome = (poder.nome || '').toLowerCase();
  const tipoLower = (tipo || poder.tipo || '').toLowerCase();
  const descricao = (poder.descricao || '').toLowerCase();
  
  // √çcones espec√≠ficos por palavra-chave no nome
  if (nome.includes('ataque') || nome.includes('golpe')) return '‚öîÔ∏è';
  if (nome.includes('defesa') || nome.includes('prote√ß√£o')) return 'üõ°Ô∏è';
  if (nome.includes('cura') || nome.includes('curar')) return 'üíö';
  if (nome.includes('fogo') || nome.includes('chamas')) return 'üî•';
  if (nome.includes('gelo') || nome.includes('frio')) return '‚ùÑÔ∏è';
  if (nome.includes('raio') || nome.includes('el√©trico')) return '‚ö°';
  if (nome.includes('vento') || nome.includes('ar')) return 'üí®';
  if (nome.includes('terra') || nome.includes('pedra')) return 'üåç';
  if (nome.includes('√°gua') || nome.includes('aqu√°tico')) return 'üíß';
  if (nome.includes('luz') || nome.includes('sagrado')) return '‚òÄÔ∏è';
  if (nome.includes('trevas') || nome.includes('sombra')) return 'üåë';
  if (nome.includes('movimento') || nome.includes('velocidade')) return 'üèÉ';
  if (nome.includes('voo') || nome.includes('voar')) return 'ü¶Ö';
  if (nome.includes('salto') || nome.includes('pular')) return 'ü¶ò';
  if (nome.includes('furtividade') || nome.includes('stealth')) return 'üë§';
  if (nome.includes('percep√ß√£o') || nome.includes('vis√£o')) return 'üëÅÔ∏è';
  if (nome.includes('for√ßa') || nome.includes('poder')) return 'üí™';
  if (nome.includes('garras') || nome.includes('presas')) return 'üêæ';
  if (nome.includes('asas')) return 'ü¶Ö';
  if (nome.includes('cauda') || nome.includes('rabo')) return 'ü¶é';
  if (nome.includes('chifres') || nome.includes('cornos')) return 'üêÇ';
  if (nome.includes('pelo') || nome.includes('pelagem')) return 'üê∫';
  if (nome.includes('escamas') || nome.includes('escamoso')) return 'üêç';
  if (nome.includes('veneno') || nome.includes('t√≥xico')) return '‚ò£Ô∏è';
  if (nome.includes('maldi√ß√£o') || nome.includes('amaldi√ßoar')) return 'üñ§';
  if (nome.includes('b√™n√ß√£o') || nome.includes('aben√ßoar')) return 'üôè';
  if (nome.includes('sorte') || nome.includes('fortuna')) return 'üçÄ';
  if (nome.includes('conhecimento') || nome.includes('saber')) return 'üìö';
  if (nome.includes('lideran√ßa') || nome.includes('comando')) return 'üëë';
  if (nome.includes('intimida√ß√£o') || nome.includes('medo')) return 'üò†';
  if (nome.includes('persuas√£o') || nome.includes('convencer')) return 'üí¨';
  if (nome.includes('diplomacia') || nome.includes('negociar')) return 'ü§ù';
  if (nome.includes('tiro') || nome.includes('disparo')) return 'üèπ';
  if (nome.includes('cr√≠tico') || nome.includes('mortal')) return 'üíÄ';
  if (nome.includes('regenera√ß√£o') || nome.includes('recuperar')) return 'üåø';
  if (nome.includes('aura') || nome.includes('presen√ßa')) return 'üåü';
  if (nome.includes('ritual') || nome.includes('cerim√¥nia')) return 'üïØÔ∏è';
  if (nome.includes('runa') || nome.includes('marca')) return 'üìú';
  if (nome.includes('animal') || nome.includes('besta')) return 'üê∫';
  if (nome.includes('natureza') || nome.includes('selvagem')) return 'üåø';
  if (nome.includes('ca√ßa') || nome.includes('rastrear')) return 'üèπ';
  if (nome.includes('heroico') || nome.includes('√©pico')) return 'üèÜ';
  if (nome.includes('lend√°rio') || nome.includes('m√≠tico')) return 'üëë';
  if (nome.includes('tormenta') || nome.includes('corrup√ß√£o')) return 'üíÄ';
  if (nome.includes('investida') || nome.includes('carga')) return 'üèá';
  if (nome.includes('combo') || nome.includes('sequ√™ncia')) return 'üåÄ';
  if (nome.includes('rajada') || nome.includes('m√∫ltiplo')) return 'üí®';
  if (nome.includes('bloqueio') || nome.includes('parar')) return 'üö´';
  if (nome.includes('esquiva') || nome.includes('desviar')) return 'üí®';
  if (nome.includes('absor√ß√£o') || nome.includes('absorver')) return 'üåÄ';
  if (nome.includes('teleporte') || nome.includes('transportar')) return '‚ö°';
  if (nome.includes('escalada') || nome.includes('escalar')) return 'üßó';
  if (nome.includes('nata√ß√£o') || nome.includes('nadar')) return 'üèä';
  if (nome.includes('acrobacia') || nome.includes('acrob√°tico')) return 'ü§∏';
  if (nome.includes('atletismo') || nome.includes('atl√©tico')) return 'üí™';
  if (nome.includes('investiga√ß√£o') || nome.includes('investigar')) return 'üîç';
  if (nome.includes('engana√ß√£o') || nome.includes('enganar')) return 'üé≠';
  if (nome.includes('faro') || nome.includes('olfato')) return 'üëÉ';
  if (nome.includes('audi√ß√£o') || nome.includes('ouvir')) return 'üëÇ';
  
  // √çcones por tipo com varia√ß√£o
  const iconsByType = {
    'combate': ['‚öîÔ∏è', 'üó°Ô∏è', 'üèπ', 'üí™', 'üëä', 'üõ°Ô∏è', 'üí•', '‚ö°'],
    'magia': ['üîÆ', '‚ú®', 'ü™Ñ', 'üåü', '‚ö°', 'üî•', '‚ùÑÔ∏è', 'üí´'],
    'destino': ['üåü', 'üéØ', 'üí´', 'üçÄ', 'üìà', 'üé≤', 'üíé', '‚≠ê'],
    'racial': ['üß¨', 'üëÅÔ∏è', 'ü¶Ö', 'üê∫', 'üåø', '‚ö°', 'üêæ', 'üí™'],
    'geral': ['‚ö°', 'üí°', 'üîß', 'üéØ', 'üìö', 'üèÉ', 'üí™', 'üåü'],
    'concedido': ['‚≠ê', 'üôè', '‚ú®', 'üí´', 'üåü', 'üëë', 'üíé', 'üî∏'],
    'tormenta': ['üíÄ', '‚ò†Ô∏è', 'üñ§', 'üëª', 'üåë', '‚ö°', 'üí•', 'üî•']
  };
  
  if (iconsByType[tipoLower]) {
    const icons = iconsByType[tipoLower];
    let hash = 0;
    for (let i = 0; i < nome.length; i++) {
      hash = ((hash << 5) - hash + nome.charCodeAt(i)) & 0xffffffff;
    }
    return icons[Math.abs(hash) % icons.length];
  }
  
  // An√°lise da descri√ß√£o
  if (descricao.includes('dano') || descricao.includes('ataque')) return '‚öîÔ∏è';
  if (descricao.includes('cura') || descricao.includes('recupera')) return 'üíö';
  if (descricao.includes('movimento') || descricao.includes('mover')) return 'üèÉ';
  if (descricao.includes('defesa') || descricao.includes('ca')) return 'üõ°Ô∏è';
  if (descricao.includes('magia')) return 'üîÆ';
  if (descricao.includes('per√≠cia')) return 'üéØ';
  
  // √çcone padr√£o √∫nico
  const fallbackIcons = ['‚ö°', '‚ú®', 'üåü', 'üí´', 'üî∏', 'üîπ', 'üíé', 'üé≠', 'üéØ', 'üîß'];
  let charSum = 0;
  for (let i = 0; i < nome.length; i++) {
    charSum += nome.charCodeAt(i);
  }
  return fallbackIcons[charSum % fallbackIcons.length];
}
// ===== FIM DA FUN√á√ÉO =====
%>

  <section class="content-section active">
    <h2>‚ú® Criar Novo Personagem</h2>
    <p style="text-align: center; margin-bottom: 2rem; color: #b8b8b8;">
      D√™ vida ao seu her√≥i! Preencha as informa√ß√µes abaixo para criar um personagem √∫nico e √©pico para suas aventuras em
      Arton.
    </p>

    <form action="/personagens/criar" method="POST" class="character-form" id="characterForm">
      <!-- Informa√ß√µes B√°sicas -->
      <div class="form-section">
        <h3>üìù Informa√ß√µes B√°sicas</h3>
        <div class="card">
          <div class="form-grid">
            <div class="form-group">
              <label for="nome">‚öîÔ∏è Nome do Personagem *</label>
              <input type="text" id="nome" name="nome" required placeholder="Ex: Alaric Fortaleza, Lyanna Luaverde..."
                maxlength="100">
              <small>Escolha um nome que reflita a personalidade e origem do seu her√≥i</small>
            </div>

            <div class="form-group">
              <label for="nivel">üìä N√≠vel</label>
              <input type="number" id="nivel" name="nivel" value="1" min="1" max="20" required>
              <small>N√≠vel inicial do personagem (geralmente 1)</small>
            </div>
          </div>
        </div>
      </div>

<!-- Atributos -->
      <div class="form-section">
        <h3>üí™ Atributos</h3>
        <div class="card">
          <div class="atributos-info" style="display: none;">
            <p>üìã <strong>Sistema Livre:</strong> Voc√™ pode distribuir os atributos livremente. <span
                id="pontosRestantes" style="display: none;">27</span></p>
          </div>

          <div
            style="background: rgba(212, 175, 55, 0.1); border: 1px solid var(--accent-gold); border-radius: 8px; padding: 1rem; margin-bottom: 2rem; text-align: center;">
            <p>üéØ <strong>Sistema Livre de Distribui√ß√£o:</strong> Ajuste os atributos conforme desejar (m√≠nimo 3, m√°ximo
              20).</p>
            <p>üí° <strong>Dica:</strong> Defina primeiro os valores que deseja, depois escolha a ra√ßa para aplicar os
              b√¥nus!</p>
            <p>‚ö° <strong>Novo Sistema:</strong> B√¥nus raciais s√£o dobrados (+1 vira +2, +2 vira +4) e voc√™ pode ajustar
              livremente!</p>
          </div>

          <div class="atributos-grid">
            <div class="atributo-card">
              <label for="forca">üí™ For√ßa</label>
              <div class="atributo-controls">
                <button type="button" class="attr-btn minus" data-attr="forca">-</button>
                <input type="number" id="forca" name="forca" value="10" min="3" max="20" readonly>
                <button type="button" class="attr-btn plus" data-attr="forca">+</button>
              </div>
              <small>For√ßa f√≠sica, ataques corpo a corpo</small>
              <div class="bonus-display" id="bonus-forca">+0</div>
            </div>

            <div class="atributo-card">
              <label for="destreza">üèÉ Destreza</label>
              <div class="atributo-controls">
                <button type="button" class="attr-btn minus" data-attr="destreza">-</button>
                <input type="number" id="destreza" name="destreza" value="10" min="3" max="20" readonly>
                <button type="button" class="attr-btn plus" data-attr="destreza">+</button>
              </div>
              <small>Agilidade, ataques √† dist√¢ncia</small>
              <div class="bonus-display" id="bonus-destreza">+0</div>
            </div>

            <div class="atributo-card">
              <label for="constituicao">‚ù§Ô∏è Constitui√ß√£o</label>
              <div class="atributo-controls">
                <button type="button" class="attr-btn minus" data-attr="constituicao">-</button>
                <input type="number" id="constituicao" name="constituicao" value="10" min="3" max="20" readonly>
                <button type="button" class="attr-btn plus" data-attr="constituicao">+</button>
              </div>
              <small>Resist√™ncia, pontos de vida</small>
              <div class="bonus-display" id="bonus-constituicao">+0</div>
            </div>

            <div class="atributo-card">
              <label for="inteligencia">üß† Intelig√™ncia</label>
              <div class="atributo-controls">
                <button type="button" class="attr-btn minus" data-attr="inteligencia">-</button>
                <input type="number" id="inteligencia" name="inteligencia" value="10" min="3" max="20" readonly>
                <button type="button" class="attr-btn plus" data-attr="inteligencia">+</button>
              </div>
              <small>Racioc√≠nio, magia arcana</small>
              <div class="bonus-display" id="bonus-inteligencia">+0</div>
            </div>

            <div class="atributo-card">
              <label for="sabedoria">üßô Sabedoria</label>
              <div class="atributo-controls">
                <button type="button" class="attr-btn minus" data-attr="sabedoria">-</button>
                <input type="number" id="sabedoria" name="sabedoria" value="10" min="3" max="20" readonly>
                <button type="button" class="attr-btn plus" data-attr="sabedoria">+</button>
              </div>
              <small>Percep√ß√£o, magia divina</small>
              <div class="bonus-display" id="bonus-sabedoria">+0</div>
            </div>

            <div class="atributo-card">
              <label for="carisma">üòé Carisma</label>
              <div class="atributo-controls">
                <button type="button" class="attr-btn minus" data-attr="carisma">-</button>
                <input type="number" id="carisma" name="carisma" value="10" min="3" max="20" readonly>
                <button type="button" class="attr-btn plus" data-attr="carisma">+</button>
              </div>
              <small>Personalidade, lideran√ßa</small>
              <div class="bonus-display" id="bonus-carisma">+0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ra√ßa, Classe e Deus -->
      <div class="form-section">
        <h3>üß¨ Origem e Voca√ß√£o</h3>
        <div class="card">
          <div class="form-grid-three">
            <div class="form-group">
              <label for="raca_id">üßù Ra√ßa *</label>
              <select id="raca_id" name="raca_id" required>
                <option value="">Escolha uma ra√ßa...</option>
                <% if (racas && racas.length> 0) { %>
                  <% racas.forEach(raca=> { %>
                    <option value="<%= raca.id %>" data-bonus='<%= JSON.stringify(raca.bonus_atributos) %>'>
                      <%= raca.nome %>
                    </option>
                    <% }); %>
                      <% } %>
              </select>
              <small>
                Define caracter√≠sticas f√≠sicas e habilidades raciais
                <br><em>‚ö†Ô∏è B√¥nus raciais s√£o aplicados automaticamente ap√≥s sele√ß√£o</em>
              </small>
            </div>

            <div class="form-group">
              <label for="classe_id">‚öîÔ∏è Classe *</label>
              <select id="classe_id" name="classe_id" required>
                <option value="">Escolha uma classe...</option>
                <% if (classes && classes.length> 0) { %>
                  <% classes.forEach(classe=> { %>
                    <option value="<%= classe.id %>" data-vida="<%= classe.pontos_vida_base %>"
                      data-mana="<%= classe.pontos_mana_base || 0 %>" data-atributo="<%= classe.atributo_principal %>">
                      <%= classe.nome %>
                    </option>
                    <% }); %>
                      <% } %>
              </select>
              <small>Determina habilidades e papel no grupo</small>
            </div>

            <div class="form-group">
              <label for="deus_id">‚≠ê Deus Patrono</label>
              <select id="deus_id" name="deus_id">
                <option value="">Sem deus espec√≠fico</option>
                <% if (deuses && deuses.length> 0) { %>
                  <% deuses.forEach(deus=> { %>
                    <option value="<%= deus.id %>">
                      <%= deus.nome %> - <%= deus.dominio %>
                    </option>
                    <% }); %>
                      <% } %>
              </select>
              <small>Divindade que seu personagem venera (opcional)</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Poderes -->
      <!-- Se√ß√£o de Poderes Melhorada para Character Create -->
      <div class="form-section">
        <h3>‚ú® Poderes</h3>

        <div class="powers-main-container">
          <!-- Header Principal -->
          <div class="powers-header">
            <h3>
              <span>‚ö°</span>
              Sistema de Poderes
              <span>‚ö°</span>
            </h3>
            <p>Escolha poderes para personalizar seu personagem</p>
          </div>

          <!-- A se√ß√£o de Poderes de Classe ser√° inserida aqui via JavaScript -->

          <!-- Poderes Raciais (Autom√°ticos) -->
          <div class="racial-powers-section" id="racialPowersSection" style="display: none;">
            <div class="racial-powers-header">
              <h4 class="racial-powers-title">
                <span>üß¨</span>
                Poderes Raciais
              </h4>
              <p class="racial-powers-description">
                Estes poderes ser√£o aplicados automaticamente baseados na ra√ßa escolhida
              </p>
            </div>

            <div id="racialPowersList" class="racial-powers-list">
              <!-- Preenchido via JavaScript quando ra√ßa for selecionada -->
            </div>
          </div>

          <!-- Poderes Dispon√≠veis para Sele√ß√£o -->
          <% if (poderesDisponiveis && Object.keys(poderesDisponiveis).length> 0) { %>
            <div class="power-selection-section">
              <div class="power-selection-header">
                <h4 class="power-selection-title">
                  <span>‚ö°</span>
                  Poderes Gerais
                </h4>
                <p class="power-selection-description">
                  Escolha poderes gerais para personalizar seu personagem (opcional)
                </p>
              </div>

              <!-- Barra de Busca -->
              <div class="powers-search-container">
                <div class="powers-search-box">
                  <span class="powers-search-icon">üîç</span>
                  <input type="text" id="powersSearchInput" class="powers-search-input"
                    placeholder="Buscar poderes por nome, descri√ß√£o ou tipo..." autocomplete="off">
                  <div id="powersSearchResults" class="powers-search-results"></div>
                </div>
              </div>

              <!-- Filtros R√°pidos -->
              <div class="powers-quick-filters">
                <div class="quick-filters-title">üéØ Filtros R√°pidos</div>
                <div class="quick-filters-buttons">
                  <button type="button" class="quick-filter-btn active" data-filter="all">
                    ‚ú® Todos
                  </button>
                  
                  <!-- Verificar se existe cada tipo antes de mostrar o filtro -->
                  <% if (typeof poderesDisponiveis !== 'undefined' && poderesDisponiveis) { %>
                    <% Object.keys(poderesDisponiveis).forEach(tipo => { %>
                      <% if (poderesDisponiveis[tipo] && poderesDisponiveis[tipo].length > 0) { %>
                        <button type="button" class="quick-filter-btn" data-filter="<%= tipo %>">
                          <% 
                            let tipoIcon = '‚ú®';
                            let tipoNome = tipo;
                            switch(tipo.toLowerCase()) {
                              case 'geral': 
                                tipoIcon = '‚ö°'; 
                                tipoNome = 'Gerais'; 
                                break;
                              case 'combate': 
                                tipoIcon = '‚öîÔ∏è'; 
                                tipoNome = 'Combate'; 
                                break;
                              case 'destino': 
                                tipoIcon = 'üåü'; 
                                tipoNome = 'Destino'; 
                                break;
                              case 'magia': 
                                tipoIcon = 'üîÆ'; 
                                tipoNome = 'Magia'; 
                                break;
                              case 'racial':
                                tipoIcon = 'üß¨'; 
                                tipoNome = 'Raciais'; 
                                break;
                              case 'concedido':
                                tipoIcon = '‚≠ê'; 
                                tipoNome = 'Concedidos'; 
                                break;
                              case 'tormenta':
                                tipoIcon = 'üíÄ'; 
                                tipoNome = 'Tormenta'; 
                                break;
                              default:
                                tipoIcon = '‚ú®';
                                tipoNome = tipo.charAt(0).toUpperCase() + tipo.slice(1);
                            }
                          %>
                          <%= tipoIcon %> <%= tipoNome %>
                        </button>
                      <% } %>
                    <% }); %>
                  <% } %>
                </div>
              </div>

              <!-- Container dos Poderes -->
              <div class="powers-sections-container">
                <% Object.entries(poderesDisponiveis).forEach(([tipo, poderes])=> { %>
                  <% if (poderes && poderes.length> 0) { %>
                    <div class="power-type-section" data-type="<%= tipo.toLowerCase() %>">
                      <div class="power-type-header">
                        <h5 class="power-type-title">
                          <% let tipoIcon='‚ú®' ; let tipoNome=tipo; switch(tipo) { case 'geral' : tipoIcon='‚ö°' ;
                            tipoNome='Poderes Gerais' ; break; case 'combate' : tipoIcon='‚öîÔ∏è' ;
                            tipoNome='Poderes de Combate' ; break; case 'destino' : tipoIcon='üåü' ;
                            tipoNome='Poderes de Destino' ; break; case 'magia' : tipoIcon='üîÆ' ;
                            tipoNome='Poderes de Magia' ; break; } %>
                            <span>
                              <%= tipoIcon %>
                            </span>
                            <%= tipoNome %>
                        </h5>
                        <div class="power-type-count">(<%= poderes.length %> dispon√≠veis)</div>
                        <button type="button" class="power-type-toggle" data-target="<%= tipo %>">
                          <span class="toggle-icon">üìÅ</span>
                        </button>
                      </div>

                      <div class="powers-grid" id="powersGrid-<%= tipo %>">
                        <% poderes.forEach(poder=> { %>
                          <label class="power-checkbox-label">
                            <input type="checkbox" name="poderes_selecionados" value="<%= poder.id %>"
                              class="power-checkbox power-checkbox-filter" data-name="<%= poder.nome.toLowerCase() %>"
                              data-type="<%= tipo %>" data-description="<%= poder.descricao.toLowerCase() %>">

                            <div class="power-card" data-power-id="<%= poder.id %>" data-type="<%= tipo.toLowerCase() %>">
                              <div class="power-card-header">
                                <div class="power-card-icon">
                                  <%= getPowerIcon(poder, tipo) %>
                                </div>

                                <h6 class="power-card-name">
                                  <%= poder.nome %>
                                </h6>
                                <p class="power-card-type">
                                  <%= tipoNome %>
                                </p>
                              </div>

                              <div class="power-card-content">
                                <p class="power-card-description">
                                  <%= poder.descricao %>
                                </p>

                                <div class="power-card-details">
                                  <% if (poder.pre_requisitos) { %>
                                    <div class="power-detail-item">
                                      <span class="power-detail-label">üìã</span>
                                      <span class="power-detail-value"><strong>Pr√©-req:</strong>
                                        <%= poder.pre_requisitos %>
                                      </span>
                                    </div>
                                    <% } %>

                                      <% if (poder.custo_pm && poder.custo_pm> 0) { %>
                                        <div class="power-detail-item">
                                          <span class="power-detail-label">üíô</span>
                                          <span class="power-detail-value"><strong>Custo:</strong>
                                            <%= poder.custo_pm %> PM
                                          </span>
                                        </div>
                                        <% } %>

                                          <% if (poder.alcance && poder.alcance !=='Pessoal' ) { %>
                                            <div class="power-detail-item">
                                              <span class="power-detail-label">üéØ</span>
                                              <span class="power-detail-value"><strong>Alcance:</strong>
                                                <%= poder.alcance %>
                                              </span>
                                            </div>
                                            <% } %>

                                              <% if (poder.duracao && poder.duracao !=='Instant√¢neo' ) { %>
                                                <div class="power-detail-item">
                                                  <span class="power-detail-label">‚è±Ô∏è</span>
                                                  <span class="power-detail-value"><strong>Dura√ß√£o:</strong>
                                                    <%= poder.duracao %>
                                                  </span>
                                                </div>
                                                <% } %>
                                </div>

                                <!-- Tags do Poder -->
                                <div class="power-tags">
                                  <span class="power-tag">
                                    <%= tipoNome %>
                                  </span>
                                  <% if (poder.custo_pm && poder.custo_pm> 0) { %>
                                    <span class="power-tag cost">
                                      <%= poder.custo_pm %> PM
                                    </span>
                                    <% } %>
                                      <% if (poder.pre_requisitos) { %>
                                        <span class="power-tag requirement">Pr√©-req</span>
                                        <% } %>
                                </div>
                              </div>
                            </div>
                          </label>
                          <% }); %>
                      </div>
                    </div>
                    <% } %>
                      <% }); %>
              </div>
            </div>
            <% } else { %>
              <!-- Estado vazio -->
              <div class="powers-empty-state">
                <div class="powers-empty-icon">üìú</div>
                <h4 class="powers-empty-title">Nenhum Poder Dispon√≠vel</h4>
                <p class="powers-empty-description">
                  N√£o h√° poderes dispon√≠veis para sele√ß√£o no momento.
                </p>
              </div>
              <% } %>
        </div>
      </div>

      <!-- Caracter√≠sticas Derivadas -->
      <div class="form-section">
        <h3>üìä Caracter√≠sticas Derivadas</h3>
        <div class="card">
          <div class="form-grid-three">
            <div class="form-group">
              <label for="pontos_vida">‚ù§Ô∏è Pontos de Vida</label>
              <input type="number" id="pontos_vida" name="pontos_vida" value="0" min="1" required readonly>
              <small>Calculado automaticamente baseado na classe e Constitui√ß√£o</small>
            </div>

            <div class="form-group">
              <label for="pontos_mana">üîµ Pontos de Mana</label>
              <input type="number" id="pontos_mana" name="pontos_mana" value="0" min="0" readonly>
              <small>Para classes que usam magia</small>
            </div>

            <div class="form-group">
              <label for="ca">üõ°Ô∏è Classe de Armadura</label>
              <input type="number" id="ca" name="ca" value="10" min="1" readonly>
              <small>10 + modificador de Destreza (pode ser alterado por equipamentos)</small>
            </div>
          </div>

          <div class="form-group">
            <label for="experiencia">‚≠ê Experi√™ncia</label>
            <input type="number" id="experiencia" name="experiencia" value="0" min="0">
            <small>Pontos de experi√™ncia acumulados (opcional)</small>
          </div>
        </div>
      </div>

      <!-- Background e Roleplay -->
      <div class="form-section">
        <h3>üé≠ Hist√≥ria e Personalidade</h3>
        <div class="card">
          <div class="form-group">
            <label for="historia_pessoal">üìú Hist√≥ria Pessoal</label>
            <textarea id="historia_pessoal" name="historia_pessoal" rows="4"
              placeholder="Descreva a origem, fam√≠lia, eventos marcantes da vida do personagem..."></textarea>
            <small>Onde nasceu? Como cresceu? O que o motivou a se tornar um aventureiro?</small>
          </div>

          <div class="form-group">
            <label for="personalidade">üé≠ Personalidade</label>
            <textarea id="personalidade" name="personalidade" rows="3"
              placeholder="Corajoso, sarc√°stico, t√≠mido, arrogante... Como seu personagem se comporta?"></textarea>
            <small>Tra√ßos de personalidade, maneirismos, medos, v√≠cios...</small>
          </div>

          <div class="form-group">
            <label for="objetivos">üéØ Objetivos e Motiva√ß√µes</label>
            <textarea id="objetivos" name="objetivos" rows="3"
              placeholder="O que seu personagem busca? Vingan√ßa? Conhecimento? Riqueza? Justi√ßa?"></textarea>
            <small>O que move seu personagem? Quais s√£o seus sonhos e ambi√ß√µes?</small>
          </div>
        </div>
      </div>

      <!-- Preview do Personagem -->
      <div class="form-section">
        <h3>üëÅÔ∏è Preview do Personagem</h3>
        <div class="card character-preview" id="characterPreview">
          <div class="preview-content">
            <div class="preview-header">
              <h4 id="previewNome">Nome do Personagem</h4>
              <p id="previewClasseRaca">Classe Ra√ßa - N√≠vel 1</p>
            </div>

            <div class="preview-stats">
              <div class="preview-atributos">
                <h5>Atributos (com b√¥nus raciais)</h5>
                <div class="attrs-preview" id="attrsPreview">
                  <!-- Preenchido via JavaScript -->
                </div>
              </div>

              <div class="preview-derivadas">
                <h5>Caracter√≠sticas</h5>
                <div class="derivadas-preview" id="derivadasPreview">
                  <!-- Preenchido via JavaScript -->
                </div>
              </div>
            </div>

            <div class="preview-poderes" id="previewPoderes" style="display: none;">
              <h5>Poderes Selecionados</h5>
              <div class="poderes-preview" id="poderesPreview">
                <!-- Preenchido via JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bot√µes de A√ß√£o -->
      <div class="form-actions">
        <button type="submit" class="nav-btn">üé® Criar Personagem</button>
        <a href="/personagens" class="btn btn-secondary">üìã Meus Personagens</a>
        <button type="button" class="btn btn-secondary" id="resetForm">üîÑ Resetar</button>
      </div>
    </form>
  </section>

  
  <!-- Scripts -->
  <script src="/scripts/character-create.js"></script>
  <script src="/scripts/class-powers.js"></script>

  <%- include('../partials/footer') %>